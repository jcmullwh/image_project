H# Docs Gaps (2026-01-20)

This file is a tracked list of documentation that is missing or incomplete relative to the current repo state (pipelinekit-based prompt pipeline, first-class experiments, artifact indexing).

## Missing / Incomplete Docs (highest leverage)

- **Experiment plugin authoring guide**
  - How to add a new experiment under `image_project/impl/current/experiment_plugins/` (plugin discovery, `register_experiment`, required fields).
  - How to structure `RunSpec` (`variant`, `run`, `generation_id`, `seed`, `cfg_dict`, `meta`) and what invariants the runner enforces.
  - How `build_plan(...)` should treat runner-owned overrides (output dirs, `run.mode`, `experiment.id`, upscale/upload toggles).
  - How to use `analyze_run(...)` and what gets stored in `experiment_results.json` (`analysis` vs `analysis_error`).
  - How to implement `build_pairs_manifest(...)` and how run-review consumes `pairs.json`.

- **Artifact schema reference (canonical, versioned)**
  - `experiment_plan.json` fields and semantics (including `config_meta`, `runner.standard_overrides`, `experiment_args`, `experiment_meta`).
  - `experiment_plan_full.json` fields (`planned_runs_full[*].cfg_dict`, `prompt_pipeline`, `config_error`).
  - `experiment_results.json` entry schema (`status`, `error`, `outputs.prompt_pipeline`, `analysis`).
  - `runs_index.jsonl` schema and how `--resume` uses it.
  - Run-review report outputs (what `run_review/report.json` contains and how `index.html` is built).

- **Data files (real data) and CSV schemas**
  - Required schema for `prompt.categories_path` CSV and `prompt.profile_path` CSV (columns, encoding, empty-row behavior).
  - Current “real data” convention under `_artifacts/data/` (and how to regenerate/update it).
  - How v5 profile CSV formats differ (like/dislike vs love/like/dislike/hate) and where those files are expected to live.
  - How generator profile hints CSVs are structured when used by blackbox stages.

- **Context injection docs**
  - What `context.enabled`, `context.injectors`, and `context.injection_location` do (including the default injector list and the warning behavior when `context.injectors` is omitted).
  - What built-in injectors exist (`image_project/impl/current/context_plugins/*`), their config blocks (`context.<name>.*`), and what metadata they write into transcripts.
  - How injector RNG seeding works (stable mixing so adding an injector does not shift other injectors).

- **Config schema reference + overlay semantics**
  - Canonical list of config keys (especially `prompt.stage_configs.defaults|instances`, `prompt.stages.include|exclude|overrides`, `prompt.output.capture_stage`).
  - Which keys are runner-owned and always overwritten for experiments (`image.*` paths, `prompt.generations_path`, `prompt.titles_manifest_path`, `run.mode`, `experiment.id`, `upscale.enabled`, `rclone.enabled`).
  - Config file resolution order and env var behavior (`config/config.yaml`, `config/config.local.yaml`, `IMAGE_PROJECT_CONFIG`).

## Missing / Incomplete Docs (secondary)

- **Prompt plan authoring guide**
  - How to add a plan plugin under `image_project/impl/current/plan_plugins/`.
  - How stage ids are resolved (StageRegistry suffix behavior + ambiguity errors).
  - When to use stage kind ids vs stage instance ids.

- **Troubleshooting guide**
  - Common failure classes and how to fix them (missing required paths, unknown stage ids, unknown stage-owned config keys, config errors in `experiment_plan_full.json`).
  - How to use `--dry-run` and inspect `experiment_plan_full.json` to debug config failures.

- **Artifacts index reference**
  - What `index-artifacts` writes (`_artifacts/index/*`), how to interpret `experiments_index.json`, and how to build combined indexes (multiple `--artifacts-root`).

- **Upscale and upload operational docs**
  - Upscale engine requirements, binary install expectations, and how `pdm run manual-upscale` relates to `upscale.enabled`.
  - rclone upload prerequisites and how `--enable-upload` interacts with `rclone.*` config.

## Legacy / Historical Docs

- Clarify (in one place) which files under `legacy/` are historical developer diaries and what the current equivalents are (experiment plugins + canonical runner).
